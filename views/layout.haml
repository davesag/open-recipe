!!! 5
%html{:xmlns => "http://www.w3.org/1999/xhtml", "xml:lang" => "en", :lang => "en" }
  %head
    %meta{ :'http-equiv' => "Content-Type", :content => "text/html; charset=UTF-8"}
    %meta{ :property => "og:title", :content => settings.name}
    %meta{ :property => "og:type", :content => "website"}
    %meta{ :property => "og:image", :content => "#{settings.owner_website}/images/Open_Recipe_Logo_Square_210x210.png"}
    %meta{ :property => "og:url", :content => 'http://apps.facebook.com/open-recipe/'}
    %meta{ :property => "og:site_name", :content => "#{settings.name} - #{settings.tagline}."}
    %meta{ :property => "fb:admins", :content => "davesag"}
    %meta{ :property => "fb:admins", :content => "amyjeeves"}
    %meta{ :property => "fb:admins", :content => "1578116633"}

    %meta{ :name => "author", :content => "davesag"}
    %meta{ :name => "robots", :content => "none"}
    %meta{ :name => "generator", :content => "Hand crafted by Dave Sag"}
    %meta{ :name => "viewport", :content => "width=760"}
    %meta{ :'http-equiv' => "X-UA-Compatible", :content => "IE=100"}
    
    %meta{ :name => "description", :content => settings.description}
    %meta{ :name => "keywords", :content => settings.keywords}
    %link{ :rel => "Shortcut Icon", :type => "image/x-icon", :href => "favicon.ico"}
    %link{ :rel => "canonical", :href => 'http://apps.facebook.com/open-recipe/'}
    %link{ :rel =>"stylesheet", :type => "text/css",
           :href => "/css/main.min.css"}
    %link{ :rel =>"stylesheet", :type => "text/css",
           :href => "/css/themes/open-recipe-theme/jquery-ui-1.8.23.custom.css"}
    %link{ :rel =>"stylesheet", :type => "text/css",
           :href => "/css/jquery.dataTables_themeroller.css"}
    %script{ :src => "/scripts/jquery-1.9.1.min.js" }
    -# %script{ :src => "/scripts/jquery-migrate-1.1.0.min.js" }
    %script{ :src => "/scripts/jquery-ui-1.10.0.custom.min.js" }
    %script{ :src => "/scripts/jquery.dataTables.min.js" }
    %script{ :src => "/scripts/jquery.validate.min.js" }
    :javascript
      var ERROR_MESSAGES = {
        'server':"#{t.errors.server}"
      };
    -# %script{ :src => "/scripts/open_recipe_ui_objects.js" }
    -# %script{ :src => "/scripts/open_recipe_core_jquery.js" }
    %script{ :src => "/scripts/open_recipe_core.min.js" }
    - if logged_in? && any_tags?
      :javascript
        $(function () {
          $.get('/favourite-tags', function(data) {
            // console.log("using data", data);
            var tag, hover_text,
                tag_data = data.tags,
                tags_html = '<h2>#{UnicodeUtils::titlecase(t.ui.tags)}</h2><ul>';
          
            for (i in tag_data) {
              tag = tag_data[i];
              // todo: finish i18n.
              hover_text = (tag.counts.recipes === 0 ? 'No' : tag.counts.recipes) + ' recipe' + (tag.counts.recipes === 1 ? '' : 's') + " " +
                            (tag.counts.meals === 0 ? 'No' : tag.counts.meals) + ' meal' + (tag.counts.meals === 1 ? '' : 's') +  " " +
                            (tag.counts.ingredients === 0 ? 'No' : tag.counts.ingredients) + ' ingredient' + (tag.counts.ingredients === 1 ? '' : 's');
              tags_html = tags_html + '<li><a class="tag" href="#" title="' + hover_text + '">' +
                          tag.name + ' <span class="tag-count">' + tag.count + '</span>';
            }
            tags_html = tags_html + '</a></li>';
            $("#tag-cloud").html(tags_html);
          })
        });
    %title #{settings.name}
  %body
    #page
      #page-top
        #title
          #header-information
            -if logged_in?
              %div.ui-widget
                %div.ui-state-highlight.ui-corner-all{:style => 'padding:0 .7em'}
                  %p<
                    %span.ui-icon.ui-icon-info{:style => 'float: left; margin-right: .3em'}<
                    #{t.ui.logged_in_as(active_user.name)}
              %div.ui-widget{:style => 'margin-top: 1em'}
                %div.ui-state-highlight.ui-corner-all{:style => 'padding:0 .7em'}
                  %p<
                    %span.ui-icon.ui-icon-search{:style => 'float: left; margin-right: .3em'}<
                      %form#search-form
                        %input#search-field{:type => 'text', :name => 'search', :placeholder => t.ui.search_text, :style => 'width:80%;'}
            -else
              %a{:href => "/login"}<
                %img.fb-login{:src => '/images/fb_login_button.png'}
            #nav-bar.ui-tabs.ui-widget.ui-widget-content.ui-corner-all
              %ul.ui-tabs-nav.ui-helper-reset.ui-helper-clearfix.ui-widget-header.ui-corner-all
                - for item in navigation
                  - selected = item[:selected]
                  - mods = "ui-state-default ui-corner-top#{selected ? ' ui-tabs-selected ui-state-active' : ''}"
                  %li{:class => mods}<
                    -if !selected
                      %a{:href => item[:href]}= item[:title]
                    -else
                      = item[:title]
          %span#logo-container<
            %img.logo{:width => 128, :height => 157,
                      :src => "/images/Open_Recipe_Logo_128x157.png",
                      :alt => "Open Recipe Logo."}
      #page-content.ui-helper-reset.ui-widget.ui-widget-content.ui-corner-all
        = yield
      - if logged_in? && any_tags?
        #tag-cloud.ui-helper-reset.ui-widget.ui-widget-content.ui-corner-all
      #page-bottom.ui-helper-reset.ui-widget.ui-widget-content.ui-corner-all
        #copyright< Â©2013 #{settings.owner}
        - if logged_in?
          %p <a href='/logout'>#{UnicodeUtils::titlecase(t.ui.log_out)}</a>
