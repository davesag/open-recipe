%h2< Edit Recipe &#8220;#{Unicode::capitalize(recipe.name)}&#8221;
#edit-recipe.edit-or-create-recipe
  %form
    %label(for = 'recipe-name')< Recipe Name:
    %input#recipe-name.ui-corner-all{:value => recipe.name}
    %label(for = "serves")< Serves:
    %input#serves.ui-corner-all{:style=>'width:3em;', :value=>recipe.serves}
    / %label.ui-state-disabled(for = "meal")< Meal Name:
    / %input#meal.ui-corner-all.ui-state-disabled{:disabled => 'disabled', :placeholder => 'not set'}
    %label(for='description')< Description:
    %textarea#description.ui-corner-all<= recipe.description
    %label(for='prep-time')< Preparation Time:
    - pt = mmhhdd_from_seconds recipe.preparation_time
    %input#prep-time-days.ui-corner-all{:style=>'width:2em;margin-right:1em;', :value => pt[:days]}
    %input#prep-time-hours.ui-corner-all{:style=>'width:2em;margin-right:1em;', :value => pt[:hours]}
    %input#prep-time-minutes.ui-corner-all{:style=>'width:2em;', :value => pt[:minutes]}
    %label(for='cooking-time')< Cooking Time:
    - ct = mmhhdd_from_seconds recipe.cooking_time
    %input#cooking-time-days.ui-corner-all{:style=>'width:2em;margin-right:1em;', :value => ct[:days]}
    %input#cooking-time-hours.ui-corner-all{:style=>'width:2em;margin-right:1em;', :value => ct[:hours]}
    %input#cooking-time-minutes.ui-corner-all{:style=>'width:2em;', :value => ct[:minutes]}
    %label(for='requirements')< Requirements
    %textarea#requirements.ui-corner-all<= recipe.requirements
    %label(for='ingredients')< Ingredients
    %table#ingredients
      %thead
        %tr
          %th< Ingredient Name
          %th< Amount
          %th< Unit
      %tbody
        -count = -1
        -for i in recipe.active_ingredients
          -count = count + 1
          %tr
            %td<
              %input.ingredient.ui-corner-all{:id => "ingredient#{count}", :value => i.ingredient.name}
            %td<
              %input.amount.ui-corner-all{:id => "amount#{count}", :value =>  i.quantity.amount}
            %td<
              %select.unit-menu{:id => "unit#{count}"}
                %option{:value => '', :label => Unicode::capitalize(t.unit.none), :selected => (i.quantity.unit == nil)}
                -for ut in UnitType.all
                  %optgroup{:label => Unicode::capitalize(ut.name)}
                    -for u in ut.allowed_units
                      %option{:value => u.id, :label => Unicode::capitalize(t.units[u.name]), :selected => (i.quantity.unit != nil && i.quantity.unit.id == u.id)}
        -count = count + 1
        %tr
          %td<
            %input.ingredient.ui-corner-all{:id => "ingredient#{count}"}
          %td<
            %input.amount.ui-corner-all{:id => "amount#{count}"}
          %td<
            %select.unit-menu{:id => "unit#{count}"}
              %option{:value => '', :label => Unicode::capitalize(t.unit.none), :selected => true}
              -for ut in UnitType.all
                %optgroup{:label => Unicode::capitalize(ut.name)}
                  -for u in ut.allowed_units
                    %option{:value => u.id, :label => Unicode::capitalize(t.units[u.name])}
    %label(for='method')< Method
    %textarea#method.ui-corner-all<= recipe.method
    %label(for='action-bar')< &nbsp;
    %span#action-bar.edit-or-create-recipe
      %input(type='submit' id='choose-photo')
      %input(type='submit' id='save-recipe')
      %input(type='submit' id='cancel')
:javascript
  var allowed_unit_options = #{allowed_units};
  var all_ingredient_names = #{ingredient_names}
  var default_allowed_unit_options = convert_to_options_html(allowed_unit_options);
  var recipe_id = #{recipe.id};
  var button_names = {
    'choose-photo': "#{Unicode::capitalize(t.ui.choose_photo)}",
    'save-recipe': "#{Unicode::capitalize(t.ui.save_recipe)}",
    'cancel': "#{Unicode::capitalize(t.ui.cancel)}"
  }
%script(src='/scripts/recipe_form_handlers.js')
