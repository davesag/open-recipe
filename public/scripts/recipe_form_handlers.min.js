var ingredient_name_autocompleter={source:all_ingredient_names,change:function(){var b=$(this).parent().parent(),c,a;if(b.is(":last-child")){c=b.siblings("tr").length+1;$(create_blank_ingredients_row(c)).appendTo(b.parent());a=b.next();$(default_allowed_unit_options).appendTo(a.find(".unit-menu"));a.find(".ingredient").autocomplete(ingredient_name_autocompleter)}}},button_handlers={"choose-photo":function(a){a.preventDefault();console.log("choose a recipe photo from your facebook photos.")},"save-recipe":function(d){d.preventDefault();var c=$(this).parents("form:first"),b,a;if(c.valid()){b=Recipe.fromForm(c);a=new Recipe_Request(b);$.post(a.post_path(),a.post_data(),function(e){if(!e.success){}else{location.href="/"}}).error(function(){alert(ERROR_MESSAGES.server)})}},cancel:function(a){a.preventDefault();location.href="/"}};Recipe.prototype.toForm=function(d){var c=$(create_blank_ingredients_row(this.active_ingredients.length)),a,e,b;$("#recipe-name").val(this.name);$("#description").val(this.description);$("#serves").val(this.serves);$("#prep-time").val(toDurationString(this.prep_time));$("#cooking-time").val(toDurationString(this.cooking_time));$("#the-method").val(this.method);$("#requirements").val(this.requirements);for(i in this.active_ingredients){a=this.active_ingredients[i];e=$(create_blank_ingredients_row(i));e.appendTo("#ingredients tbody");e.find("#ingredient"+i).val(a.ingredient);e.find("#amount"+i).val(a.quantity.amount);b=e.find("#unit"+i);$(default_allowed_unit_options).appendTo(b);b.val(a.quantity.unit_id)}c.appendTo("#ingredients tbody");$(default_allowed_unit_options).appendTo(c.find("select"));$("input.ingredient").autocomplete(ingredient_name_autocompleter)};Recipe.fromForm=function(c){var f=[],e=$("#ingredients .ingredient").length,g=parseDuration($("#cooking-time").val()),k=parseDuration($("#prep-time").val()),d,h,j,b;for(i=0;i<e;i++){d=$("#ingredient"+i).val();h=$("#amount"+i).val();j=$("#unit"+i).val();if(d!==""){console.log("ingredient = "+d+", amount = "+h+", unit = "+j);b=new Quantity(h,j);f.push(new ActiveIngredient(d,b))}}return new Recipe(recipe_id,$("#recipe-name").val(),parseInt($("#serves").val()),g,k,$("#description").val(),$("#the-method").val(),$("#requirements").val(),f,null,null)};function to_seconds(c,a,b){return c*24*60*60+a*60*60+b*60}function parseDuration(e){if(e==null||e===""){return 0}var b=new RegExp(/([0-9][0-9]?)[ ]?m/),g=new RegExp(/([0-9][0-9]?)[ ]?h/),d=new RegExp(/([0-9])[ ]?d/),f=0,a=0,c=0;if(b.test(e)){c=parseInt(b.exec(e)[1])}if(g.test(e)){a=parseInt(g.exec(e)[1])}if(d.test(e)){f=parseInt(d.exec(e)[1])}return to_seconds(f,a,c)}function toDurationString(c){if(c<=0){return""}var b=Math.floor((c/60)%60),e=Math.floor((c/3600)%24),f=Math.floor(c/86400),a="";if(f>0){a=a+f+"d "}if(e>0){a=a+e+"h "}if(b>0){a=a+b+"m "}return a.substring(0,a.length-1)}function validate_duration(d,c){var e=$(c),a=e.val(),b=parseDuration(a);return(this.optional(c)||(b!==0||(a==="0"||a==="")))}$(function(){$.validator.addMethod("duration",validate_duration);if(recipe_id==0){for(i=0;i<3;i++){$(create_blank_ingredients_row(i)).appendTo("#ingredients tbody")}$(default_allowed_unit_options).appendTo("#ingredients .unit-menu")}$("#ingredients .ingredient").autocomplete(ingredient_name_autocompleter)});
